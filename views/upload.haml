%html
  %head
    %title ListenUp Audiobook Validator
    %link(rel="stylesheet" href="http://yui.yahooapis.com/2.8.0r4/build/reset/reset-min.css")
    %link(rel="stylesheet" href="http://45.79.191.135/css/style.css")
    %link(rel="stylesheet" href="http://45.79.191.135/css/bar.css")
  %body
    #wrapper
      #header
        %h1 ListenUp Audiobook Validator DEMO APP
        %br
        %br
        %h2 To validate and master your audio for delivery, simply select ONE WAV audio file containing an edited master of your narration. Then, click the 'Upload!' button.
        %br
        %h2 A score of 40 or higher indicates a passing grade.
        %br
        %br
        Please be sure to upload WAV or FLAC audio for best results. Note that AutoMastering takes a bit of time after the upload completes, so don't panic if you don't see something show up right after the upload completes. When we setup the system at ListenUp, all files will be run through Amazon S3, so no uploads will be necessary, and AutoMastering will be performed at very fast speeds.
        %br
        %br
        %br
        %br
      #content
        %form(method="post" enctype='multipart/form-data')
          %input{:type => "file", :multiple => "true", :name => "myfiles[]"}
          %br
          %br
          %input(type='submit' value='Upload!')
        <div class="progress">
        <div class="bar"></div >
        <div class="percent">0%</div >
        </div>
        <div id="status"></div>
        %script{:type => "text/javascript", :src => "http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"}
        %script{:type => "text/javascript", :src => "http://malsup.github.com/jquery.form.js"}
        :javascript
          (function() {
            var bar = $('.bar');
            var percent = $('.percent');
            var status = $('#status');
            $('form').ajaxForm({
                beforeSend: function() {
                    status.empty();
                    var percentVal = '0%';
                    bar.width(percentVal)
                    percent.html(percentVal);
                },
                uploadProgress: function(event, position, total, percentComplete) {
                    var percentVal = percentComplete + '%';
                    bar.width(percentVal)
                    percent.html(percentVal);
                //console.log(percentVal, position, total);
                },
                success: function() {
                    var percentVal = '100%';
                    bar.width(percentVal)
                    percent.html(percentVal);
                },
              complete: function(xhr) {
                status.html(xhr.responseText);
              }
            }); 
          })();